[supervisord]
nodaemon=true
user=root
logfile=/app/logs/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/app/logs

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

# ========================================
# API FastAPI (uvicorn)
# ========================================
[program:api]
command=uvicorn main:app --host 0.0.0.0 --port %(ENV_API_PORT)s --reload --reload-delay 2
directory=/app
user=root
autostart=true
autorestart=true
stdout_logfile=/app/logs/api.log
stderr_logfile=/app/logs/api_error.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
environment=PATH="/usr/local/bin:/usr/bin:/bin",PYTHONUNBUFFERED="1"

# ========================================
# Reminder Worker (interactions)
# ========================================
[program:reminder_worker]
command=python -m workers.reminder_worker
directory=/app
user=root
autostart=true
autorestart=true
stdout_logfile=/app/logs/reminder_worker.log
stderr_logfile=/app/logs/reminder_worker_error.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
environment=PATH="/usr/local/bin:/usr/bin:/bin",PYTHONUNBUFFERED="1"

# Red√©marrage si crash
startsecs=10
startretries=3
stopwaitsecs=10

# ========================================
# Email Worker (optionnel - si Celery)
# ========================================
# [program:email_worker]
# command=celery -A tasks.celery_app worker --loglevel=info
# directory=/app
# user=root
# autostart=true
# autorestart=true
# stdout_logfile=/app/logs/email_worker.log
# stderr_logfile=/app/logs/email_worker_error.log
